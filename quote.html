<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Handy Sparkle</title>
		<link rel="icon" href="/favicon.ico" type="image/x-icon" />
		<link rel="stylesheet" href="index.css" />
		<!-- Add Bootstrap CSS if needed -->
		<link
			rel="stylesheet"
			href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
		/>
	</head>
	<body>
		<div class="nav-bar">
			<div class="logo-container">
				<a href="index.html">
					<img src="logo.svg" alt="Handy Sparkle Logo" />
				</a>
				<a href="index.html">
					<h1>Handy Sparkle</h1>
				</a>
			</div>
			<nav class="nav-links">
				<ul>
					<li><a href="quote.html">Booking</a></li>
					<span class="vertical-line"></span>
					<li><a href="about.html">About Us</a></li>
				</ul>
			</nav>
		</div>
		<br />
		<div class="container mt-5">
			<h1 class="section-heading">Get a Quote</h1>

			<!-- Cleaning Details Form -->
			<div id="notification" style="display: none" class="alert"></div>
			<form
				id="quoteForm"
				onsubmit="event.preventDefault(); calculateEstimate();"
			>
				<div class="form-group">
					<label for="serviceType">Type of Service:</label>
					<select id="serviceType" name="serviceType" required>
						<option value="" disabled selected>Select a service</option>
						<option value="One time cleaning">One time cleaning</option>
						<option value="Regular cleaning">Regular cleaning</option>
					</select>
				</div>
				<div class="form-group">
					<label for="bedrooms">Number of Bedrooms:</label>
					<input
						type="number"
						class="form-control"
						id="bedrooms"
						min="0"
						required
					/>
				</div>
				<div class="form-group">
					<label for="bathrooms">Number of Bathrooms:</label>
					<input
						type="number"
						class="form-control"
						id="bathrooms"
						min="0"
						required
					/>
				</div>
				<div class="form-group">
					<label for="kitchens">Number of Kitchens:</label>
					<input
						type="number"
						class="form-control"
						id="kitchens"
						min="0"
						required
					/>
				</div>
				<div class="form-group">
					<label for="livingRooms">Number of Living Rooms:</label>
					<input
						type="number"
						class="form-control"
						id="livingRooms"
						min="0"
						required
					/>
				</div>
				<div class="form-group">
					<label for="serviceDate">Date of Service:</label>
					<input type="date" class="form-control" id="serviceDate" required />
				</div>
				<button type="submit" class="btn btn-primary">Get a Quote</button>
			</form>

			<!-- Estimate Result and Personal Details Form -->
			<div id="estimateResult" class="mt-4" style="display: none">
				<h3 id="estimatedTotal">
					Your Estimated Total: <span id="total"></span> and Duration:
					<span id="duration"></span>
				</h3>
				<h3>Estimated Rate: <span id="rate"></span> per hour</h3>
				<form id="bookingForm">
					<!-- Hidden fields for cleaning details -->
					<input type="hidden" name="serviceType" id="serviceTypeValue" />
					<input type="hidden" name="total" id="totalValue" />
					<input type="hidden" name="duration" id="durationValue" />
					<input type="hidden" name="rate" id="rateValue" />
					<input type="hidden" name="bedrooms" id="bedroomsValue" />
					<input type="hidden" name="bathrooms" id="bathroomsValue" />
					<input type="hidden" name="kitchens" id="kitchensValue" />
					<input type="hidden" name="livingRooms" id="livingRoomsValue" />
					<input type="hidden" name="serviceDate" id="serviceDateValue" />

					<!-- Personal Contact Information -->
					<div class="form-group">
						<label for="customerName">Name:</label>
						<input
							type="text"
							class="form-control"
							id="customerName"
							name="customerName"
							required
						/>
					</div>
					<div class="form-group">
						<label for="customerPhone">Phone Number:</label>
						<input
							type="tel"
							class="form-control"
							id="customerPhone"
							name="customerPhone"
							required
						/>
					</div>
					<div class="form-group">
						<label for="customerEmail">Email:</label>
						<input
							type="email"
							class="form-control"
							id="customerEmail"
							name="customerEmail"
							required
						/>
					</div>
					<button type="submit" class="btn btn-success">
						Secure Your Quote
					</button>
				</form>
			</div>
		</div>

		<script>
			var oneTimeRate = {
				bedrooms: {
					duration: 15, // per room
					unitPrice: 50, // per hour
				},
				bathrooms: {
					duration: 25, // per room
					unitPrice: 55, // per hour
				},
				kitchens: {
					duration: 25, // per room
					unitPrice: 55, // per hour
				},
				livingRooms: {
					duration: 20, // per room
					unitPrice: 45, // per hour
				},
			};
			var regularRate = {
				bedrooms: {
					duration: 15, // per room
					unitPrice: 45, // per hour
				},
				bathrooms: {
					duration: 20, // per room
					unitPrice: 50, // per hour
				},
				kitchens: {
					duration: 25, // per room
					unitPrice: 50, // per hour
				},
				livingRooms: {
					duration: 15, // per room
					unitPrice: 40, // per hour
				},
			};

			function calculateEstimate() {
				const serviceTypeElement = document.getElementById("serviceType");
				const serviceType = serviceTypeElement.value;
				const bedrooms = document.getElementById("bedrooms").value;
				const bathrooms = document.getElementById("bathrooms").value;
				const kitchens = document.getElementById("kitchens").value;
				const livingRooms = document.getElementById("livingRooms").value;
				const serviceDate = document.getElementById("serviceDate").value;

				if (bedrooms < 0 || bathrooms < 0 || kitchens < 0 || livingRooms < 0) {
					showNotification("Please enter valid non-negative values.", "danger");
					return;
				}

				serviceTypeElement.addEventListener("change", (event) => {
					var selectedServiceType = event.target.value;
					console.log(`Selected service type: ${selectedServiceType}`);
				});

				document.addEventListener("DOMContentLoaded", function () {
					var today = new Date().toISOString().split("T")[0];
					document.getElementById("serviceDate").setAttribute("min", today);
				});

				var today = new Date().toISOString().split("T")[0];
				if (serviceDate < today) {
					showNotification(
						"Please select a valid date (today or later).",
						"danger"
					);
					return; // Exit the function if validation fails
				}

				var total, duration, rate;

				if (serviceType === "One time cleaning") {
					total =
						((bedrooms * oneTimeRate.bedrooms.duration) / 60) *
							oneTimeRate.bedrooms.unitPrice +
						((bathrooms * oneTimeRate.bathrooms.duration) / 60) *
							oneTimeRate.bathrooms.unitPrice +
						((kitchens * oneTimeRate.kitchens.duration) / 60) *
							oneTimeRate.kitchens.unitPrice +
						((livingRooms * oneTimeRate.livingRooms.duration) / 60) *
							oneTimeRate.livingRooms.unitPrice;
					total = Math.round(total * 100) / 100;

					duration =
						bedrooms * 15 + bathrooms * 25 + kitchens * 25 + livingRooms * 20;

					rate = total / (duration / 60);
				} else if (serviceType === "Regular cleaning") {
					total =
						((bedrooms * regularRate.bedrooms.duration) / 60) *
							regularRate.bedrooms.unitPrice +
						((bathrooms * regularRate.bathrooms.duration) / 60) *
							regularRate.bathrooms.unitPrice +
						((kitchens * regularRate.kitchens.duration) / 60) *
							regularRate.kitchens.unitPrice +
						((livingRooms * regularRate.livingRooms.duration) / 60) *
							regularRate.livingRooms.unitPrice;

					duration =
						bedrooms * 15 + bathrooms * 20 + kitchens * 25 + livingRooms * 15;

					rate = total / (duration / 60);
				}
				rate = Math.round(rate * 100) / 100;

				document.getElementById("serviceTypeValue").textContent = serviceType;
				document.getElementById("total").textContent = `AU$${total}`;
				document.getElementById("duration").textContent = `${duration} minutes`;
				document.getElementById("rate").textContent = `AU$${rate}`;
				document.getElementById("totalValue").value = total;
				document.getElementById("durationValue").value = duration;
				document.getElementById("rateValue").value = rate;

				document.getElementById("bedroomsValue").value = bedrooms;
				document.getElementById("bathroomsValue").value = bathrooms;
				document.getElementById("kitchensValue").value = kitchens;
				document.getElementById("livingRoomsValue").value = livingRooms;
				document.getElementById("serviceDateValue").value =
					document.getElementById("serviceDate").value;

				// Display the personal details form

				if (serviceType === "Regular cleaning") {
					document.getElementById("estimateResult").style.display = "block";
					document.getElementById("estimatedTotal").style.display = "none";
				} else if (serviceType === "One time cleaning") {
					document.getElementById("estimateResult").style.display = "block";
					document.getElementById("estimatedTotal").style.display = "block";
				}
			}

			// Handle AJAX submission of the booking form
			document
				.getElementById("bookingForm")
				.addEventListener("submit", async function (e) {
					e.preventDefault(); // Prevent the default form submission

					const formData = new FormData(this);
					const data = {};

					formData.forEach((value, key) => {
						data[key] = value;
					});

					try {
						const response = await fetch(
							"https://handy-sparkle-backend-2de7f358d4c0.herokuapp.com/send-quote",
							{
								method: "POST",
								headers: {
									"Content-Type": "application/json",
								},
								body: JSON.stringify(data),
							}
						);

						if (response.ok) {
							showNotification(
								"Quote request sent successfully. We will be in touch soon!",
								"success"
							);
						} else {
							showNotification(
								"Failed to send quote request. Please try again.",
								"danger"
							);
						}
					} catch (error) {
						console.error("Error:", error);
						showNotification(
							"Failed to send quote request. Please try again.",
							"danger"
						);
					}
				});

			function showNotification(message, type) {
				const notification = document.getElementById("notification");
				notification.textContent = message;
				notification.className = `alert alert-${type}`;
				notification.style.display = "block";
			}
		</script>

		<br />
		<h1 class="section-heading">Our Services</h1>
		<br />
		<div class="service-container">
			<div class="service">
				<img src="house-cleaning.jpg" alt="House Keeping" />
				<h2>House Keeping</h2>
			</div>
			<div class="service">
				<img src="end-of-lease.jpg" alt="End of Lease" />
				<h2>End of Lease</h2>
			</div>
			<div class="service">
				<img src="office-clean.webp" alt="Office Cleaning" />
				<h2>Office</h2>
			</div>
		</div>
		<br />
		<br />
		<div class="footer">
			<p>Made by Handy Sparkle</p>
			<p>Copyright © 2024</p>
		</div>
	</body>
</html>
